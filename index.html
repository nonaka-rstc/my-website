Google Gemini
ジェミニ-クリ

/検索するには 入力してください
コード
問題
1.5k
プルリクエスト
322
議論
アクション
プロジェクト
1
安全
洞察
ジェミニ-クリ/ドキュメント/ cli
/認証.md
ファイルへ移動
t
gsquared94
gsquared94
ドキュメント: ADC で Vertex AI 認証を使用する方法を更新 ( #6193 )
055fe46
 · 
先週

プレビュー

コード

非難
173行 (138 箇所) · 11.3 KB
認証設定
Gemini CLI を使用するには、Google の AI サービスへの認証が必要です。初回起動時に、以下のいずれかの認証方法を設定する必要があります。

Googleでログイン（Gemini Code Assist）：

Google アカウントでログインするにはこのオプションを使用します。

Gemini CLI の初回起動時に、認証用のウェブページが表示されます。認証が完了すると、認証情報がローカルにキャッシュされるため、次回以降の実行ではウェブログインを省略できます。

Web ログインは、Gemini CLI が実行されているマシンと通信できるブラウザで行う必要があることに注意してください。(具体的には、ブラウザは Gemini CLI がリッスンするローカルホストの URL にリダイレクトされます)。

次の場合、ユーザーは GOOGLE_CLOUD_PROJECT を指定する必要がある場合があります。

Google Workspace アカウントをお持ちです。Google Workspace は、企業や組織向けの有料サービスで、カスタムメールドメイン（例：your-name@your-company.com）、強化されたセキュリティ機能、管理機能など、生産性向上ツールスイートを提供しています。これらのアカウントは、多くの場合、雇用主または学校によって管理されます。
Google Developer Programを通じて Gemini Code Assist ライセンスを取得していること（資格のある Google Developer Expert を含む）
現在の Gemini Code Assist 標準またはエンタープライズ サブスクリプションのライセンスが割り当てられています。
無料の個人使用がサポートされている地域外で製品を使用しています。
あなたは18歳未満のGoogleアカウント所有者です
これらのいずれかのカテゴリに該当する場合は、まず使用する Google Cloud プロジェクト ID を設定し、Gemini for Cloud API を有効にして、アクセス権限を設定する必要があります。
次のコマンドを使用して、現在のシェル セッションで環境変数を一時的に設定できます。

export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"
繰り返し使用する場合は、環境変数を.env ファイルまたはシェルの設定ファイル（~/.bashrc、~/.zshrc、 など~/.profile）に追加します。例えば、次のコマンドは環境変数を~/.bashrcファイルに追加します。
echo 'export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"' >> ~/.bashrc
source ~/.bashrc
Gemini API キー:

Google AI Studio から API キーを取得します: https://aistudio.google.com/app/apikey
環境変数を設定しますGEMINI_API_KEY。以下のメソッドの を、YOUR_GEMINI_API_KEYGoogle AI Studioから取得したAPIキーに置き換えてください。
次のコマンドを使用して、現在のシェル セッションで環境変数を一時的に設定できます。

export GEMINI_API_KEY="YOUR_GEMINI_API_KEY"
繰り返し使用するために、環境変数を.env ファイルに追加できます。

あるいは、シェルの設定ファイル（~/.bashrc、~/.zshrc、 など~/.profile）からAPIキーをエクスポートすることもできます。例えば、次のコマンドは環境変数を~/.bashrcファイルに追加します。

echo 'export GEMINI_API_KEY="YOUR_GEMINI_API_KEY"' >> ~/.bashrc
source ~/.bashrc
⚠️シェル構成ファイル内で API キーをエクスポートすると、シェルから実行される他のプロセスでもそのキーを読み取ることができることに注意してください。

頂点AI：

APIキー:

Google Cloud APIキーを取得する: APIキーを取得する
環境変数を設定しますGOOGLE_API_KEY。以下のメソッドの をYOUR_GOOGLE_API_KEYVertex AI API キーに置き換えてください。
次のコマンドを使用して、現在のシェル セッションで環境変数を一時的に設定できます。

export GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"
繰り返し使用する場合は、環境変数を.env ファイルまたはシェルの設定ファイル（~/.bashrc、~/.zshrc、 など~/.profile）に追加します。例えば、次のコマンドは環境変数を~/.bashrcファイルに追加します。

echo 'export GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"' >> ~/.bashrc
source ~/.bashrc
⚠️シェル構成ファイル内で API キーをエクスポートすると、シェルから実行される他のプロセスでもそのキーを読み取ることができることに注意してください。

注: のようなエラーが発生した場合"API keys are not supported by this API - Expected OAuth2 access token or other authentication credentials that assert a principal"、組織でサービスアカウントAPIキーの作成が制限されている可能性があります。その場合は、以下で説明するサービスアカウントJSONキーメソッドをお試しください。

アプリケーションのデフォルト資格情報 (ADC):

注:GOOGLE_API_KEYまたは環境変数 を以前に設定していた場合はGEMINI_API_KEY、アプリケーションのデフォルト資格情報を使用するためにそれらを設定解除する必要があります。

unset GOOGLE_API_KEY GEMINI_API_KEY
使用方法gcloud（ローカル開発の場合）:

Google Cloud プロジェクトがあり、Vertex AI API が有効になっていることを確認します。
ユーザー資格情報を使用してログインします。
gcloud auth application-default login
詳細については、Google Cloud のアプリケーションのデフォルト認証情報を設定するをご覧ください。
サービス アカウントの使用 (アプリケーションの場合、またはサービス アカウント API キーが制限されている場合):

組織のポリシーにより API キーを作成できない場合、または非対話型環境で実行している場合は、サービス アカウント キーを使用して認証できます。
サービスアカウントとキーを作成し、JSONキーファイルをダウンロードしてください。サービスアカウントには「Vertex AI ユーザー」ロールを割り当てる必要があります。
GOOGLE_APPLICATION_CREDENTIALS環境変数を JSON ファイルの絶対パスに 設定します。
現在のシェル セッションで環境変数を一時的に設定できます。
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/keyfile.json"
繰り返し使用する場合、コマンドをシェルの設定ファイルに追加できます (例: ~/.bashrc)。
echo 'export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/keyfile.json"' >> ~/.bashrc
source ~/.bashrc
⚠️シェル構成ファイル内でサービス アカウントの資格情報をエクスポートすると、シェルから実行される他のプロセスがそれを読み取ることができることに注意してください。
ADC に必要な環境変数:

ADC（またはgcloudサービスアカウント）を使用する場合は、環境変数GOOGLE_CLOUD_PROJECTとGOOGLE_CLOUD_LOCATION環境変数も設定する必要があります。以下のメソッドで、YOUR_PROJECT_IDとYOUR_PROJECT_LOCATIONをプロジェクトの適切な値に置き換えてください。
次のコマンドを使用して、現在のシェル セッションでこれらの環境変数を一時的に設定できます。
export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"
export GOOGLE_CLOUD_LOCATION="YOUR_PROJECT_LOCATION" # e.g., us-central1
繰り返し使用する場合は、環境変数を.env ファイルまたはシェルの設定ファイル（~/.bashrc、~/.zshrc、 など~/.profile）に追加することができます。例えば、次のコマンドは環境変数を~/.bashrcファイルに追加します。
echo 'export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"' >> ~/.bashrc
echo 'export GOOGLE_CLOUD_LOCATION="YOUR_PROJECT_LOCATION"' >> ~/.bashrc
source ~/.bashrc
クラウドシェル:

このオプションは、Google Cloud Shell 環境で実行している場合にのみ使用できます。

Cloud Shell 環境にログインしているユーザーの認証情報が自動的に使用されます。

これは、Cloud Shell で実行されており、他の方法が構成されていない場合のデフォルトの認証方法です。

:warning: Be advised that when you export your API key inside your shell configuration file, any other process executed from the shell can read it.
環境変数を.envファイルに保存する
.gemini/.envプロジェクトディレクトリまたはホームディレクトリにファイルを作成できます。プレーン.envファイルの作成も可能ですが、.gemini/.envGeminiの変数を他のツールから分離しておくために、こちらの方が推奨されます。

重要:一部の環境変数（ や などDEBUG）は、gemini-cli の動作への干渉を防ぐため、DEBUG_MODEプロジェクトファイルから自動的に除外されます。gemini -cli 固有の変数については、ファイルを使用してください。.env.gemini/.env

Gemini CLI は、次の検索順序を使用して、最初に見つかったファイルから環境変数を自動的に読み込みます。 .env

現在のディレクトリから始めて に向かって上方に移動し/、各ディレクトリに対して次のチェックを実行します。
.gemini/.env
.env
ファイルが見つからない場合は、ホームディレクトリに戻ります。
~/.gemini/.env
~/.env
重要:検索は最初に見つかったファイルで停止します。変数は複数のファイル間で結合されません。

例
プロジェクト固有のオーバーライド(プロジェクト内にいるときに優先されます):

mkdir -p .gemini
echo 'GOOGLE_CLOUD_PROJECT="your-project-id"' >> .gemini/.env
ユーザー全体の設定（すべてのディレクトリで使用可能）:

mkdir -p ~/.gemini
cat >> ~/.gemini/.env <<'EOF'
GOOGLE_CLOUD_PROJECT="your-project-id"
GEMINI_API_KEY="your-gemini-api-key"
EOF
非対話型モード / ヘッドレス環境
Gemini CLI を非対話型環境で実行する場合、対話型ログインフローは使用できません。代わりに、環境変数を使用して認証を設定する必要があります。

CLI は、非対話型ターミナルで実行されているかどうかを自動的に検出し、使用可能な場合は次のいずれかの認証方法を使用します。

Gemini API キー:

環境変数を設定しますGEMINI_API_KEY。
CLI はこのキーを使用して Gemini API で認証します。
頂点AI：

環境変数を設定しますGOOGLE_GENAI_USE_VERTEXAI=true。
API キーの使用:環境変数を設定しますGOOGLE_API_KEY。
アプリケーションデフォルト資格情報 (ADC) の使用:
gcloud auth application-default loginご使用の環境で実行してADC を構成します。
GOOGLE_CLOUD_PROJECTおよび環境変数が設定されていることを確認しますGOOGLE_CLOUD_LOCATION。
非対話型セッションでこれらの環境変数のいずれも設定されていない場合、CLI はエラーで終了します。
